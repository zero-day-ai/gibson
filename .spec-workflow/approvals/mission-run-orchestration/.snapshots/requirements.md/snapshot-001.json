{
  "id": "snapshot_1767563900199_wafo5biyn",
  "approvalId": "approval_1767563900189_bmtsc61eh",
  "approvalTitle": "Requirements: Mission Run Orchestration",
  "version": 1,
  "timestamp": "2026-01-04T21:58:20.199Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: Mission Run Orchestration\n\n## Introduction\n\nThe `gibson mission run` command currently only creates a mission record in the database and sets its status to \"running\", but does not actually execute the workflow. This spec updates the `mission run` command to fully wire up the mission orchestrator and execute the workflow, invoking agents as defined in the workflow YAML.\n\n## Alignment with Product Vision\n\nGibson is an LLM-powered automated security testing platform. Missions are the core unit of work - they define multi-agent workflows that coordinate security testing activities. Without actually executing workflows, the platform cannot fulfill its core purpose. This feature enables end-to-end mission execution from the CLI.\n\n## Requirements\n\n### Requirement 1: Wire Up Mission Orchestrator in `mission run`\n\n**User Story:** As a security engineer, I want `gibson mission run -f workflow.yaml` to actually execute the workflow so that agents perform security testing as defined.\n\n#### Acceptance Criteria\n\n1. WHEN user runs `gibson mission run -f <workflow.yaml>` THEN the system SHALL parse the workflow, create a mission, AND execute the workflow using the orchestrator\n2. WHEN workflow execution begins THEN the system SHALL initialize all required dependencies (LLM registry, harness factory, workflow executor, registry adapter)\n3. WHEN workflow nodes reference agents THEN the system SHALL invoke registered agents via the harness\n4. WHEN workflow execution completes THEN the system SHALL update mission status to completed/failed and persist findings\n\n### Requirement 2: Progress Streaming\n\n**User Story:** As a security engineer, I want to see mission progress in real-time so that I can monitor the security testing activity.\n\n#### Acceptance Criteria\n\n1. WHEN workflow execution is in progress THEN the system SHALL emit progress events\n2. WHEN `--verbose` flag is set THEN the system SHALL print node execution status, agent invocations, and findings as they occur\n3. WHEN an agent produces a finding THEN the system SHALL immediately persist and display it\n\n### Requirement 3: Graceful Interruption\n\n**User Story:** As a security engineer, I want to be able to stop a running mission with Ctrl+C so that I can halt testing if needed.\n\n#### Acceptance Criteria\n\n1. WHEN user presses Ctrl+C during execution THEN the system SHALL gracefully cancel the workflow context\n2. WHEN workflow is cancelled THEN the system SHALL update mission status to \"cancelled\" and preserve any findings discovered\n3. WHEN execution is interrupted THEN the system SHALL clean up resources (close harnesses, etc.)\n\n### Requirement 4: Blocking vs Background Execution\n\n**User Story:** As a security engineer, I want the option to run missions in the foreground (blocking) or background so I can choose my workflow.\n\n#### Acceptance Criteria\n\n1. WHEN user runs `gibson mission run -f <file>` (default) THEN the system SHALL execute in foreground and block until complete\n2. WHEN user runs `gibson mission run -f <file> --background` THEN the system SHALL start execution and return immediately with mission ID\n3. IF running in background THEN user SHALL be able to check progress with `gibson mission show <name>`\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- **Single Responsibility Principle**: Orchestrator initialization should be extracted to reusable function (similar to `createAttackRunner` in attack.go)\n- **Modular Design**: Reuse existing components from attack.go initialization pattern\n- **Dependency Management**: Use existing core.CommandContext pattern, extended with orchestrator dependencies\n- **Clear Interfaces**: Leverage existing MissionOrchestrator interface\n\n### Performance\n- Mission execution should start within 2 seconds of command invocation\n- Progress updates should be emitted at least every 5 seconds during active execution\n\n### Security\n- No new security considerations beyond existing mission/workflow execution\n\n### Reliability\n- If orchestrator initialization fails, provide clear error message and exit gracefully\n- Partial findings should be persisted even if mission fails\n\n### Usability\n- Error messages should clearly indicate which dependency failed to initialize\n- Verbose mode should provide actionable insight into execution progress\n",
  "fileStats": {
    "size": 4327,
    "lines": 76,
    "lastModified": "2026-01-04T21:58:14.520Z"
  },
  "comments": []
}