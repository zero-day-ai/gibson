name: whistler-local-network-scan
description: Hypothesis-driven local network reconnaissance using Whistler orchestrator
version: "1.0"

# LLM Configuration
config:
  llm:
    default_provider: anthropic
    default_model: claude-opus-4-5-20251101

# Target Specification
target:
  seeds:
    - value: "192.168.1.0/24"
      type: cidr
      scope: in_scope
  profile: aggressive
  depth: 3

# Workflow DAG
nodes:
  # Phase 1: Initialize Whistler reconnaissance
  # Whistler generates 5-10 hypotheses about the local network infrastructure
  - id: whistler_init
    type: agent
    name: Whistler Initialization
    description: Generate reconnaissance hypotheses for local network
    agent: whistler
    timeout: 5m
    retry:
      max_retries: 1
      backoff: constant
      initial_delay: 30s
    task:
      goal: "Initialize reconnaissance of local network"
      context:
        phase: "init"

  # Phase 2a: Network reconnaissance (parallel execution)
  # Crease performs aggressive port scanning and service fingerprinting
  - id: crease_network
    type: agent
    name: Network Port Scanning
    description: Aggressive port scan and service enumeration on discovered hosts
    agent: crease
    depends_on:
      - whistler_init
    timeout: 15m
    retry:
      max_retries: 0  # No retries for network scanning
      backoff: constant
      initial_delay: 1s
    task:
      goal: "Port scan discovered hosts"
      context:
        profile: "aggressive"
        techniques:
          - port_scanning
          - service_fingerprinting
          - os_detection

  # Phase 2b: Web reconnaissance (parallel execution)
  # Carl discovers web services, crawls endpoints, and identifies APIs
  - id: carl_web
    type: agent
    name: Web Service Discovery
    description: Discover and enumerate web services and endpoints
    agent: carl
    depends_on:
      - whistler_init
    timeout: 20m
    retry:
      max_retries: 1
      backoff: constant
      initial_delay: 30s
    task:
      goal: "Discover web services and endpoints"
      context:
        profile: "aggressive"
        techniques:
          - http_discovery
          - endpoint_enumeration
          - api_detection
          - directory_fuzzing

  # Phase 3: Analyze reconnaissance results
  # Whistler queries GraphRAG for child agent results and updates hypotheses
  - id: whistler_analyze
    type: agent
    name: Hypothesis Analysis
    description: Update hypotheses based on reconnaissance findings
    agent: whistler
    depends_on:
      - crease_network
      - carl_web
    timeout: 10m
    retry:
      max_retries: 1
      backoff: exponential
      initial_delay: 30s
      max_delay: 2m
      multiplier: 2.0
    task:
      goal: "Analyze reconnaissance results"
      context:
        phase: "analyze"

  # Phase 4: Build final attack surface map
  # Whistler generates comprehensive AttackSurfaceMap with all discovered assets
  - id: whistler_final
    type: agent
    name: Attack Surface Mapping
    description: Generate comprehensive attack surface map and findings
    agent: whistler
    depends_on:
      - whistler_analyze
    timeout: 10m
    retry:
      max_retries: 1
      backoff: constant
      initial_delay: 30s
    task:
      goal: "Generate attack surface map"
      context:
        phase: "final"
        export_format: json
        include_coverage_metrics: true
