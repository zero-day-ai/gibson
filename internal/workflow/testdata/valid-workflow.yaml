# Valid workflow with multiple node types and dependencies
name: Valid Security Assessment
description: A comprehensive workflow demonstrating all features

nodes:
  # Entry point - reconnaissance
  - id: recon
    type: agent
    name: Reconnaissance Phase
    description: Gather initial target information
    agent: recon-agent
    timeout: 5m
    retry:
      max_retries: 3
      backoff: exponential
      initial_delay: 1s
      max_delay: 30s
      multiplier: 2.0
    task:
      target: example.com
      depth: comprehensive

  # Parallel scanning operations
  - id: parallel_scan
    type: parallel
    name: Parallel Port Scanning
    description: Scan multiple port ranges concurrently
    depends_on:
      - recon
    sub_nodes:
      - id: scan_common_ports
        type: agent
        name: Common Ports Scan
        agent: port-scanner
        timeout: 2m
        task:
          port_range: 1-1024

      - id: scan_full_range
        type: agent
        name: Full Range Scan
        agent: port-scanner
        timeout: 10m
        task:
          port_range: 1-65535

  # Join point for parallel operations
  - id: join_scans
    type: join
    name: Wait for All Scans
    depends_on:
      - parallel_scan

  # Analysis with tool invocation
  - id: analyze
    type: tool
    name: Analyze Scan Results
    description: Process and analyze scan data
    tool: vulnerability-analyzer
    depends_on:
      - join_scans
    timeout: 15m
    input:
      analysis_depth: deep
      check_cves: true
      min_severity: medium

  # Conditional branching based on findings
  - id: check_vulnerabilities
    type: condition
    name: Vulnerability Check
    description: Determine next steps based on findings
    depends_on:
      - analyze
    condition:
      expression: result.vulnerabilities.count > 0 && result.severity >= "high"
      true_branch:
        - exploit_assessment
      false_branch:
        - standard_report

  # Exploitation path
  - id: exploit_assessment
    type: agent
    name: Exploit Assessment
    description: Assess exploitability of found vulnerabilities
    agent: exploit-checker
    timeout: 30m
    retry:
      max_retries: 2
      backoff: linear
      initial_delay: 5s
    task:
      safe_mode: true
      max_attempts: 3

  - id: detailed_report
    type: plugin
    name: Generate Detailed Report
    description: Create comprehensive vulnerability report
    plugin: report-generator
    method: generate_detailed
    depends_on:
      - exploit_assessment
    params:
      format: pdf
      include_recommendations: true
      include_exploits: true
      severity_threshold: medium

  # Standard reporting path
  - id: standard_report
    type: plugin
    name: Generate Standard Report
    description: Create standard assessment report
    plugin: report-generator
    method: generate_standard
    params:
      format: pdf
      include_summary: true

  # Final notification (depends on both report paths)
  - id: notify_team
    type: tool
    name: Send Notification
    description: Notify security team of completion
    tool: notification-service
    depends_on:
      - detailed_report
      - standard_report
    input:
      channels:
        - email
        - slack
      recipients:
        - security@example.com
      priority: high
      include_summary: true
