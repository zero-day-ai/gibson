# Execution Context Relationships
# These relationships link execution entities (missions, agent runs, tool executions)
# to each other and to the assets/findings they discover or produce.
# They enable audit trails and provenance tracking.

relationship_types:
  # PART_OF: agent_run -> mission
  - id: rel.execution.part_of
    name: PART_OF
    type: PART_OF
    category: execution
    description: "Agent run is part of a mission"
    from_types: [agent_run]
    to_types: [mission]
    bidirectional: false
    properties:
      - name: run_order
        type: int
        required: false
        description: "Execution order within the mission"

  # EXECUTED_BY: tool_execution -> agent_run
  - id: rel.execution.executed_by
    name: EXECUTED_BY
    type: EXECUTED_BY
    category: execution
    description: "Tool execution was performed by an agent run"
    from_types: [tool_execution]
    to_types: [agent_run]
    bidirectional: false

  # MADE_CALL: llm_call -> agent_run
  - id: rel.execution.made_call
    name: MADE_CALL
    type: MADE_CALL
    category: execution
    description: "LLM call was made by an agent run"
    from_types: [llm_call]
    to_types: [agent_run]
    bidirectional: false

  # DISCOVERED: agent_run -> (any asset node or finding)
  - id: rel.execution.discovered
    name: DISCOVERED
    type: DISCOVERED
    category: execution
    description: "Agent run discovered an asset or finding"
    from_types: [agent_run]
    to_types: [domain, subdomain, host, port, service, endpoint, api, technology, cloud_asset, certificate, finding]
    bidirectional: false
    properties:
      - name: discovery_timestamp
        type: string
        required: false
        description: "When the asset was discovered (ISO 8601)"
      - name: discovery_method
        type: string
        required: false
        description: "Method used for discovery"

  # PRODUCED: tool_execution -> finding
  - id: rel.execution.produced
    name: PRODUCED
    type: PRODUCED
    category: execution
    description: "Tool execution produced a finding"
    from_types: [tool_execution]
    to_types: [finding]
    bidirectional: false
    properties:
      - name: confidence
        type: float64
        required: false
        description: "Confidence in the finding (0.0-1.0)"
      - name: discovered_at
        type: string
        required: false
        description: "When the finding was discovered (ISO 8601)"

  # DELEGATED_TO: agent_run -> agent_run
  - id: rel.execution.delegated_to
    name: DELEGATED_TO
    type: DELEGATED_TO
    category: execution
    description: "Agent run delegated a task to another agent run"
    from_types: [agent_run]
    to_types: [agent_run]
    bidirectional: false
    properties:
      - name: task_description
        type: string
        required: false
        description: "Description of the delegated task"
      - name: delegated_at
        type: string
        required: false
        description: "When the delegation occurred (ISO 8601)"

  # ANALYZES: intelligence -> (various asset nodes and findings)
  - id: rel.execution.analyzes
    name: ANALYZES
    type: ANALYZES
    category: execution
    description: "Intelligence node analyzes these entities"
    from_types: [intelligence]
    to_types: [host, port, endpoint, technology, finding, domain, subdomain]
    bidirectional: false
    properties:
      - name: analysis_timestamp
        type: string
        required: false
        description: "When the analysis relationship was created (ISO 8601)"
      - name: relevance_score
        type: float64
        required: false
        description: "Relevance of this entity to the intelligence analysis (0.0-1.0)"

  # GENERATED_BY: intelligence -> llm_call
  - id: rel.execution.generated_by
    name: GENERATED_BY
    type: GENERATED_BY
    category: execution
    description: "Intelligence was generated by this LLM call"
    from_types: [intelligence]
    to_types: [llm_call]
    bidirectional: false
    properties:
      - name: generation_timestamp
        type: string
        required: false
        description: "When the intelligence was generated (ISO 8601)"

  # PART_OF_MISSION: intelligence -> mission
  - id: rel.execution.part_of_mission
    name: PART_OF_MISSION
    type: PART_OF_MISSION
    category: execution
    description: "Intelligence belongs to this mission"
    from_types: [intelligence]
    to_types: [mission]
    bidirectional: false
    properties:
      - name: phase
        type: string
        required: false
        description: "Reconnaissance phase this intelligence relates to"
